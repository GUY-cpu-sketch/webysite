<!DOCTYPE html>
<html>
<head>
  <title>Chat App</title>
  <style>
    body { background-color: #333; color: white; font-family: Arial; }
    #chatBox { height: 400px; overflow-y: scroll; border: 1px solid #666; padding: 10px; }
    .whisper { background: yellow; color: black; padding: 2px 5px; border-radius: 4px; }
    .system { color: gray; font-style: italic; }
  </style>
</head>
<body>
  <h2>Chat</h2>
  <div id="chatBox"></div>
  <input id="msg" placeholder="Message..." autocomplete="off">
  <button onclick="sendMessage()">Send</button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const chatBox = document.getElementById("chatBox");
    const msgInput = document.getElementById("msg");

    function appendMessage(text, type="normal") {
      const p = document.createElement("p");
      if (type === "system") p.className = "system";
      if (type === "whisper") p.className = "whisper";
      p.textContent = text;
      chatBox.appendChild(p);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function sendMessage() {
      const message = msgInput.value.trim();
      if (message) {
        socket.emit("chat", { message });
        msgInput.value = "";
      }
    }

    socket.on("system", msg => appendMessage(msg, "system"));
    socket.on("chat", data => appendMessage(`${data.username}: ${data.message}`));
    socket.on("whisper", data => appendMessage(`[Whisper] ${data.from} -> ${data.to}: ${data.message}`, "whisper"));
    socket.on("force-close", () => {
      document.body.innerHTML = "<h1>Chat closed by admin</h1>";
    });
  </script>
</body>
</html>
